{% extends 'layout.html.twig' %}
    
{% block body %}
    {{ parent() }}
    
    {% for flashMessage in app.session.flashbag.get('notice') %}
        <script>alert('{{ flashMessage }}');</script>
    {% endfor %}
    
    <section class="jumbotron">
        <div class="container">
            <h2>Proyecto: {{proyectoSeleccionado.nombre}}</h2>
        </div>
    </section>

    <div class="container">
        <div class="row">
            {{ include('menuProyecto.html.twig')}}
            <div class="col-md-9">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4 class="panel-title">Categorias del Proyecto</h4>
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover table-condensed" id="tabla">
                                <thead>
                                    <tr class="info">
                                        <th>Categoria</th>
                                        <th>Requisitos</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for categoria in categorias %}
                                        {% if categoria.activo == true %}
                                            {% set contador = 0 %}
                                            {% for requisito in requisitos %}
                                                {% if categoria.nombre == requisito.categoria.nombre and requisito.activo == true %}
                                                    {% set contador = contador + 1 %}
                                                {% endif %}
                                            {% endfor %}
                                            <tr>
                                                <td rowspan="{{ contador }}">
                                                    <strong>{{ categoria.nombre }}</strong>
                                                </td>
                                                {% set contadorRequisito = 0 %}
                                                {% for requisito in requisitos %}
                                                    {% if categoria.nombre == requisito.categoria.nombre and requisito.activo == true %}
                                                       {% if contadorRequisito == 0%}
                                                            <td>{{ requisito.nombre }}</td>
                                                            <td>
                                                                <a href="{{ path('mtd_requisito_eliminar', { 'id': requisito.id }) }}" class="btn btn-sm btn-danger btn-delete confirmarEliminacion">
                                                                    Eliminar
                                                                </a>
                                                            </td>
                                                       {% else %}
                                                            <tr>
                                                                <td>{{ requisito.nombre }}</td>
                                                                <td>
                                                                    <a href="{{ path('mtd_requisito_eliminar', { 'id': requisito.id }) }}" class="btn btn-sm btn-danger btn-delete confirmarEliminacion">
                                                                        Eliminar
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                       {% endif %}
                                                       {% set contadorRequisito = contadorRequisito + 1 %}
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>    
                            </table>
                        </div>
                    </div>
                </div>

                <div class="panel panel-primary">
                    <div class="panel-heading" role="tab" id="heading2">
                        <h4 class="panel-title">
                            <a href="#collapse2" data-toggle="collapse" data-parent="#accordion">
                                Agregar Categoria
                            </a>
                        </h4>
                    </div>
                    <div id="collapse2" class="panel-collapse collapse">
                        <div class="panel-body">

                            {{ form_start(form) }}
                                {{form_errors(form)}}

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class ="form-group">
                                            <div class="input-group">
                                                {{ form_label(form.categoria, 'Seleccione la Categoria:', {'label_attr': {'class': 'input-group-addon addonGroup'}}) }}
                                                <div style="display:none;">
                                                {{ form_widget(form.categoria, { 'attr': { 'class': 'form-control inputGroup',
                                                                             'title': 'Seleccione una categoria' } }) }}
                                                </div>
                                                
                                                <select id="categoria" name="categoria" required="required" class="form-control inputGroup" title="Seleccione una categoria">
                                                    {% for key,val in form.categoria.vars.choices %}
                                                        {% set contador = 0 %}
                                                        {% for categoria in categorias %}
                                                                {% if categoria.id != val.value and categoria.activo == true %}
                                                                    {% set contador = contador + 1 %}
                                                                {% endif %}
                                                        {% endfor %}
                                                        {% if contador == categorias|length%}
                                                            <option value="{{ val.value }}">{{ val.label | trans }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            {{ form_errors(form.categoria) }}
                                        </div>
                                    </div>
                                </div>

                                <div class ="form-group">
                                    <button type="submit" id ="enviar" name="enviar" class="btn btn-primary"> Agregar</button>
                                </div>

                            {{form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}